{% extends 'base.html' %}

{% block header %}
  <h2>{% block title %}Add Story{% endblock title %}</h2>
{% endblock header %}

{% block content %}

  <form method="post" style="margin-bottom: 20px;" autocomplete="off">
    <div>
        Author: {{current_user.user_name}}
    </div>
    <div class="form-group">
        <label for="title">Title</label>
        <input type="text" name="title" id="title" class="form-control">{{ request.form['title'] }}</textarea>
    </div>
    <div class="form-group">
        <label for="note">Note</label>
        <textarea name="note" id="notes" class="form-control">{{ request.form['note'] }}</textarea>
    </div>
    <div class="form-group">
        <label for="systeminstruction">AI Guidance</label>
        <textarea name="systeminstruction" id="systeminstruction" class="form-control">{{ request.form['systeminstruction'] }}</textarea>
    </div>
    <div class="d-flex justify-content-between">
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Post</button>
        </div>
        <div>
            <button type="button" class= "btn btn-primary" data-bs-toggle="modal" data-bs-target="#assignSysInt">Get</button>
        </div>
    </div>
</form>
<!-- Modal Add AI Guidance -->
<div class="modal fade" id="assignSysInt" tabindex="-1" aria-labelledby="assignSysInt" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <form id="assignSysIntForm">
            <div class="modal-header">
            <h5 class="modal-title" id="assignSysIntLabel">Assign AI Guidance</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <div class="mb-3">
                <label for="sysIntSelect" class="form-label">Choose AI Guidance</label>
                <select class="form-select" id="sysIntSelect" name="sysint_id" required>
                {% for sysint in sysints %}
                    <option value="{{ sysint.sysint_id }}">
                    {{ sysint.name }}
                    </option>
                {% endfor %}
                </select>
            </div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="picked" onclick="pickSysInt()">Add</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </form>
        </div>
    </div>
</div>

<script>
    function pickSysInt(){
        const id = document.getElementById("sysIntSelect").value;
        $.ajax({
            url: "/getSysInt",
            type: "post",
            data: {'sysint_id': id},
            dataType: "json"
        }).done(function(response) {
            document.getElementById("systeminstruction").value = response['instruction'];
            const modal = bootstrap.Modal.getInstance(document.getElementById('assignSysInt'));
            modal.hide();
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.log("AJAX Error", textStatus, errorThrown);
        });
    };

</script>
{% endblock content %}